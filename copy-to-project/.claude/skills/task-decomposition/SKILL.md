---
name: task-decomposition
description: Декомпозиция сложных задач на шаги с feedback loop. Используй когда задача большая или нечёткая.
---

При получении сложной или нечёткой задачи — СНАЧАЛА декомпозируй, ПОТОМ выполняй.

## Когда применять

- Задача затрагивает 3+ файлов
- Нет чёткого описания "что делать"
- Задача включает несколько разных типов работы (код + тесты + документация)
- Оценка времени выполнения > 5 минут
- Есть зависимости между шагами

## Алгоритм декомпозиции

### Шаг 1: Уточнение цели

Перед декомпозицией задай вопросы:

```
Уточняю задачу:
1. Конечная цель: <что должно работать/измениться>
2. Критерии готовности: <как понять что сделано>
3. Ограничения: <что НЕ нужно менять>
```

### Шаг 2: Разбиение на шаги

Каждый шаг должен быть:
- **Атомарным** — можно выполнить за 1-3 минуты
- **Проверяемым** — есть способ убедиться что сделано правильно
- **Независимым** — минимум зависимостей от других шагов

Формат шага:
```
[ ] Шаг N: <действие>
    Файлы: <список файлов>
    Проверка: <команда или визуальная проверка>
```

### Шаг 3: Feedback loop

После КАЖДОГО шага:

1. **Выполни** шаг
2. **Проверь** результат (команда из поля "Проверка")
3. **Отметь** как выполненный: `[x]`
4. **Сообщи** пользователю краткий статус

```
✓ Шаг N выполнен: <что сделано>
  Проверка: <результат команды>
  Следующий: Шаг N+1
```

## Пример декомпозиции

Задача: "Добавить авторизацию в API"

```markdown
## Декомпозиция: Авторизация в API

### Цель
Добавить JWT-авторизацию для защищённых эндпоинтов.

### Критерии готовности
- Эндпоинты /api/protected/* требуют токен
- Есть эндпоинт /api/login для получения токена
- Тесты проходят

### Шаги

[ ] Шаг 1: Добавить зависимости
    Файлы: requirements.txt
    Проверка: pip install -r requirements.txt

[ ] Шаг 2: Создать модуль auth
    Файлы: src/auth.py
    Проверка: python -c "from src.auth import create_token"

[ ] Шаг 3: Добавить middleware
    Файлы: src/middleware.py
    Проверка: python -m pytest tests/test_middleware.py

[ ] Шаг 4: Создать эндпоинт login
    Файлы: src/routes/auth.py
    Проверка: curl -X POST localhost:8000/api/login

[ ] Шаг 5: Защитить эндпоинты
    Файлы: src/routes/api.py
    Проверка: curl localhost:8000/api/protected → 401

[ ] Шаг 6: Написать тесты
    Файлы: tests/test_auth.py
    Проверка: python -m pytest tests/test_auth.py

[ ] Шаг 7: Обновить документацию
    Файлы: docs/API.md
    Проверка: визуальная проверка
```

## Правила

1. **Не пропускай шаги** — даже если кажется очевидным
2. **Не объединяй шаги** — лучше много мелких чем мало крупных
3. **Проверяй после каждого шага** — не накапливай ошибки
4. **Сообщай прогресс** — пользователь должен видеть движение
5. **Если шаг провалился** — останови выполнение, сообщи пользователю

## Интеграция с TodoWrite

Используй TodoWrite для отслеживания прогресса:

```
TodoWrite([
  {content: "Шаг 1: ...", status: "completed"},
  {content: "Шаг 2: ...", status: "in_progress"},
  {content: "Шаг 3: ...", status: "pending"},
])
```

## Когда НЕ применять

- Простая правка 1-2 файлов
- Задача чётко описана и понятна
- Это исследование/поиск информации
